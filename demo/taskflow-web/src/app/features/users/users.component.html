<div class="users-container">
  <div class="page-header">
    <h1>
      <mat-icon class="header-icon">people</mat-icon>
      User Profiles
    </h1>
    <p class="subtitle">
      Manage and view all user profiles in the system (Demo Mode)
    </p>
  </div>

  @if (isLoading()) {
    <div class="loading-container">
      <mat-spinner></mat-spinner>
      <p>Loading user profiles...</p>
    </div>
  } @else if (error()) {
    <mat-card class="error-card">
      <mat-card-content>
        <mat-icon>error</mat-icon>
        <p>{{ error() }}</p>
        <button mat-raised-button color="primary" (click)="loadPage(1)">Retry</button>
      </mat-card-content>
    </mat-card>
  } @else {
    <mat-card class="users-card">
      <mat-card-header>
        <mat-card-title>
          All Users ({{ totalUsers() }}) - Page {{ currentPage() }} of {{ totalPages() }}
        </mat-card-title>
        <mat-card-subtitle>
          Current user:
          <strong>{{ userContext.currentUser()?.displayName || 'None' }}</strong>
        </mat-card-subtitle>
      </mat-card-header>

      <mat-card-content>
        <table mat-table [dataSource]="users()" class="users-table">
          <!-- Name Column -->
          <ng-container matColumnDef="displayName">
            <th mat-header-cell *matHeaderCellDef>Name</th>
            <td mat-cell *matCellDef="let user">
              <div class="user-name-cell">
                <mat-icon class="user-avatar">account_circle</mat-icon>
                <span>{{ user.displayName }}</span>
                @if (user.userId === currentUserId()) {
                  <mat-chip class="current-user-chip">You</mat-chip>
                }
              </div>
            </td>
          </ng-container>

          <!-- Email Column -->
          <ng-container matColumnDef="email">
            <th mat-header-cell *matHeaderCellDef>Email</th>
            <td mat-cell *matCellDef="let user">{{ user.email }}</td>
          </ng-container>

          <!-- Role Column -->
          <ng-container matColumnDef="role">
            <th mat-header-cell *matHeaderCellDef>Role</th>
            <td mat-cell *matCellDef="let user">
              @if (isAdmin(user)) {
                <mat-chip class="admin-chip" highlighted>
                  <mat-icon>admin_panel_settings</mat-icon>
                  Admin
                </mat-chip>
              } @else if (isStakeholder(user)) {
                <mat-chip class="stakeholder-chip">
                  <mat-icon>business</mat-icon>
                  Stakeholder
                </mat-chip>
              } @else {
                <mat-chip>
                  <mat-icon>person</mat-icon>
                  Team Member
                </mat-chip>
              }
            </td>
          </ng-container>

          <!-- Created Column -->
          <ng-container matColumnDef="createdAt">
            <th mat-header-cell *matHeaderCellDef>Created</th>
            <td mat-cell *matCellDef="let user">
              {{ formatDate(user.createdAt) }}
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr
            mat-row
            *matRowDef="let row; columns: displayedColumns;"
            [class.current-user-row]="row.userId === currentUserId()">
          </tr>
        </table>

        <mat-paginator
          [length]="totalUsers()"
          [pageSize]="10"
          [pageIndex]="currentPage() - 1"
          [hidePageSize]="true"
          [showFirstLastButtons]="true"
          (page)="onPageChange($event)">
        </mat-paginator>
      </mat-card-content>
    </mat-card>
  }
</div>
